(this.webpackJsonp=this.webpackJsonp||[]).push([["sui-mail-on-order-change"],{A7h5:function(e){e.exports=JSON.parse("{}")},"AE8+":function(e,t){e.exports='{% block sw_order_state_change_modal_attach_documents_button_wrapper %}\n    <div class="sw-order-state-change-modal-attach-documents__button-wrapper">\n        <div>\n            {% block sw_order_state_change_modal_attach_documents_send_mail_switch %}\n                <sw-field class="sw-order-state-change-modal-attach-documents__switch"\n                          type="switch"\n                          :label="$tc(\'sw-order.stateCard.labelSendMailSwitch\')"\n                          v-model="sendMail"\n                          @change="onConfirm">\n                </sw-field>\n            {% endblock %}\n        </div>\n\n        {% block sw_order_state_change_modal_attach_documents_button %}\n            <sw-button class="sw-order-state-change-modal-assign-mail-template__button"\n                       variant="primary"\n                       v-if="!sendMail"\n                       size="small"\n                       @click="onConfirmNoMail">\n                {{ $tc(\'sui.ordermail.update\') }}\n            </sw-button>\n        {% endblock %}\n    </div>\n{% endblock %}\n'},GVrr:function(e){e.exports=JSON.parse("{}")},HtrP:function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=c(e);if(t){var i=c(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.r(t);var m=Shopware.Classes.ApiService,d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(c,e);var t,n,a,s=l(c);function c(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sui/order-status";return i(this,c),(n=s.call(this,e,t,a)).name="SuiOrderStatusApiService",n.httpClient=e,n}return t=c,(n=[{key:"sendPost",value:function(e,t){var n="/_action/".concat(this.getApiBasePath(),"/").concat(e);return this.httpClient.post(n,t,{headers:this.getBasicHeaders()}).then((function(e){return m.handleResponse(e)}))}}])&&o(t.prototype,n),a&&o(t,a),c}(m),u=Shopware.Application;u.addServiceProvider("SuiOrderStatusApiService",(function(e){var t=u.getContainer("init");return new d(t.httpClient,e.loginService)}));var p=n("h+xT"),h=n.n(p);function f(e,t,n,a,i,o,r){try{var l=e[o](r),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,i)}function _(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var o=e.apply(t,n);function r(e){f(o,a,i,r,l,"next",e)}function l(e){f(o,a,i,r,l,"throw",e)}r(void 0)}))}}Shopware.Component.override("sw-order-state-change-modal",{template:h.a,inject:["SuiOrderStatusApiService"],props:{order:{type:Object,required:!0},isLoading:{type:Boolean,required:!0},mailTemplatesExist:{required:!1},technicalName:{type:String,required:!0}},data:function(){return{showModal:!1,assignMailTemplatesOptions:[],userCanConfirm:!1,userHasAssignedMailTemplate:!1,docIds:[],mailTemplateId:null,hasPreviewTemplate:!1,mail:{toField:"",subject:"",content:""},sendMail:!1}},computed:{modalTitle:function(){return this.mailTemplatesExist||this.userHasAssignedMailTemplate?this.$tc("sw-order.documentCard.modalTitle"):this.$tc("sw-order.assignMailTemplateCard.cardTitle")}},methods:{onCancel:function(){this.$emit("page-leave")},onDocsConfirm:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.sendMail=t,this.docIds=e},onSendMail:function(){var e=this;return _(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.sendMail){t.next=3;break}return t.next=3,e.SuiOrderStatusApiService.sendPost("mail",{templateId:e.mailTemplateId,orderId:e.order.id,preview:!1,content:e.mail.content,subject:e.mail.subject,toField:e.mail.toField,documentIds:e.docIds});case 3:return t.next=5,e.closeModal();case 5:e.onNoMailConfirm();case 6:case"end":return t.stop()}}),t)})))()},closeModal:function(){this.hasPreviewTemplate=!1},onPreviewEmail:function(e){var t=this;return _(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.hasPreviewTemplate=!0,t.mailTemplateId=e,n.next=4,t.SuiOrderStatusApiService.sendPost("mail",{templateId:e,orderId:t.order.id,preview:!0}).then((function(e){t.hasPreviewTemplate=!0,t.mail={toField:e.toField,subject:e.subject,content:e.content}}));case 4:case"end":return n.stop()}}),n)})))()},onNoMailConfirm:function(){this.$emit("page-leave-confirm",[],!1)},onAssignMailTemplate:function(){this.userHasAssignedMailTemplate=!0}}});var w=n("VgYI"),g=n.n(w);n("iGN5");function b(e,t,n,a,i,o,r){try{var l=e[o](r),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,i)}var v=Shopware.Data.Criteria;Shopware.Component.register("sw-order-state-change-modal-assign-mail-template",{template:g.a,inject:["repositoryFactory","systemConfigApiService"],props:{order:{type:Object,required:!0},mailTemplatesExist:{required:!1},technicalName:{type:String,required:!0},sendMail:{required:!0}},data:function(){return{userHasSetMailTemplate:!1,selectedMailTemplateId:null,mailTemplates:null,mailTemplateTypeIds:null,allTechnicalNames:null,hasPreviewTemplate:!1,searchTerm:null}},computed:{mailTemplateRepository:function(){return this.repositoryFactory.create("mail_template")},mailTemplateSalesChannelAssociationRepository:function(){return this.repositoryFactory.create("mail_template_sales_channel")},getSelectedMailTemplateCriteria:function(){var e=new v;return e.addAssociation("mailTemplateType"),e},mailTemplateGridColumns:function(){return[{property:"radioButtons",label:null,rawData:!0,sortable:!1},{property:"mailTemplateType.name",label:"sw-order.assignMailTemplateCard.gridColumnType",rawData:!0,sortable:!1},{property:"description",label:"sw-order.assignMailTemplateCard.gridColumnDescription",rawData:!0,sortable:!0}]}},created:function(){this.createdComponent()},methods:{onPreviewEmail:function(){this.$emit("on-mail-preview",this.selectedMailTemplateId)},mailTemplateSelectionCriteria:function(){var e=new v;return e.addAssociation("mailTemplateType"),e},getSelectedMailTemplate:function(e){return this.mailTemplateRepository.get(e,Shopware.Context.api,this.getSelectedMailTemplateCriteria)},onChangeMailTemplate:function(e){e&&(this.selectedMailTemplateId=e,this.userHasSetMailTemplate=!0)},onConfirmNoMail:function(){this.$emit("on-no-mail-confirm")},onCreateMailTemplate:function(){var e=this;new Promise((function(t){t(e.$emit("on-create-mail-template"))})).then((function(){e.$router.push({name:"sw.mail.template.create"})}))},fillValues:function(){var e=this,t=this.searchTerm,n=this.mailTemplateSelectionCriteria().setLimit(10);this.mailTemplateTypeIds&&n.addFilter(v.equalsAny("mailTemplateType.id",this.mailTemplateTypeIds)),t&&n.addFilter(v.contains("mailTemplateType.name",t)),this.mailTemplateRepository.search(n,Shopware.Context.api).then((function(t){e.total=t.total,e.mailTemplates=t,e.isLoading=!1}))},onColumnSort:function(){this.userHasSetMailTemplate=!1},onSearchTermChange:function(e){this.searchTerm=e,this.fillValues()},createdComponent:function(){var e,t=this;return(e=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.systemConfigApiService.getValues("SuiMailOnOrderChange.config").then((function(e){t.mailTemplateTypeIds=e["SuiMailOnOrderChange.config.mailTemplates"],t.isLoading=!1}));case 2:t.fillValues();case 3:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(a,i){var o=e.apply(t,n);function r(e){b(o,a,i,r,l,"next",e)}function l(e){b(o,a,i,r,l,"throw",e)}r(void 0)}))})()}}});var T=n("AE8+"),y=n.n(T);Shopware.Component.override("sw-order-state-change-modal-attach-documents",{template:y.a,props:{order:{type:Object,required:!0},isLoading:{type:Boolean,required:!0}},data:function(){return{sendMail:!1}},methods:{onConfirm:function(){var e=[];this.$refs.attachDocuments.documents.forEach((function(t){t.attach&&e.push(t.id)})),this.$emit("on-confirm",e,this.sendMail)},onConfirmNoMail:function(){this.$emit("on-no-mail-confirm")}}});n("GVrr"),n("A7h5")},VgYI:function(e,t){e.exports='{% block sw_order_state_change_modal_assign_mail_template %}\n    <div class="sw-order-state-change-modal-assign-mail-template" v-if="sendMail">\n\n        {% block sw_order_state_change_modal_assign_mail_template_wrapper %}\n            <div class="sw-order-state-change-modal-assign-mail-template__wrapper">\n\n                {% block sw_order_state_change_modal_assign_mail_template_card %}\n                    <sw-card>\n                        <template #toolbar>\n\n                            {% block sw_order_state_change_modal_assign_mail_template_card_filter %}\n                                <sw-card-filter\n                                        @sw-card-filter-term-change="onSearchTermChange">\n                                </sw-card-filter>\n                            {% endblock %}\n                        </template>\n\n                        {% block sw_order_state_change_modal_assign_mail_template_grid %}\n                            <sw-entity-listing\n                                    class="sw-order-state-change-modal-assign-mail-template__entity-listing"\n                                    @column-sort="onColumnSort"\n                                    :repository="mailTemplateRepository"\n                                    :columns="mailTemplateGridColumns"\n                                    :items="mailTemplates"\n                                    :criteriaLimit="10"\n                                    :showSelection="false"\n                                    :showSettings="false"\n                                    :showActions="false"\n                                    :allowColumnEdit="false"\n                                    :skeletonItemAmount="3"\n                                    ref="mailTemplateGridRef">\n\n                                {% block sw_order_state_change_modal_assign_mail_template_grid_radio_column %}\n                                    <template\n                                            class="sw-order-state-change-modal-assign-mail-template__radio-column"\n                                            #column-radioButtons="{ item }">\n\n                                        {% block sw_order_state_change_modal_assign_mail_template_grid_radio_column_wrapper %}\n                                            <div class="sw-order-state-change-modal-assign-mail-template__radio-button-wrapper">\n\n                                                {% block sw_order_state_change_modal_assign_mail_template_grid_radio_column_button %}\n                                                    <sw-radio-field\n                                                            class="sw-order-state-change-modal-assign-mail-template__radio-button"\n                                                            name="mailTemplate"\n                                                            @change="onChangeMailTemplate(item.id)"\n                                                            :options="[{ value: item.id }]">\n                                                    </sw-radio-field>\n                                                {% endblock %}\n                                            </div>\n                                        {% endblock %}\n                                    </template>\n                                {% endblock %}\n                            </sw-entity-listing>\n                        {% endblock %}\n                    </sw-card>\n                {% endblock %}\n\n                {% block sw_order_state_change_modal_assign_mail_template_button_wrapper %}\n                    <div class="sw-order-state-change-modal-assign-mail-template__button-wrapper">\n\n                        {% block sw_order_state_change_modal_assign_mail_template_button_assign_mail_template %}\n                            <sw-button class="sw-order-state-change-modal-assign-no-mail-template__button"\n                                       variant="primary"\n                                       :disabled="!userHasSetMailTemplate"\n                                       size="small"\n                                       @click="onPreviewEmail">\n                                {{ $tc(\'sui.ordermail.preview\') }}\n                            </sw-button>\n                        {% endblock %}\n\n                    </div>\n                {% endblock %}\n\n            </div>\n        {% endblock %}\n    </div>\n{% endblock %}\n'},ZMm1:function(e,t,n){},"h+xT":function(e,t){e.exports='{% block sw_order_state_change_modal %}\n    <sw-modal :title="modalTitle"\n              @modal-close="onCancel"\n              class="sw-order-state-change-modal">\n\n        {% block sw_order_state_change_modal_attach_documents_component %}\n            <sw-order-state-change-modal-attach-documents\n                    :order="order"\n                    :isLoading="isLoading"\n                    @on-confirm="onDocsConfirm"\n                    @on-no-mail-confirm="onNoMailConfirm">\n            </sw-order-state-change-modal-attach-documents>\n        {% endblock %}\n\n            <sw-order-state-change-modal-assign-mail-template\n                    :mailTemplatesExist="mailTemplatesExist"\n                    :technicalName="technicalName"\n                    :order="order"\n                    :sendMail="sendMail"\n                    @on-mail-preview="onPreviewEmail"\n                    @on-no-mail-confirm="onNoMailConfirm"\n                    @on-assigned-mail-template="onAssignMailTemplate"\n                    @on-create-mail-template="onCancel">\n            </sw-order-state-change-modal-assign-mail-template>\n\n            <sw-modal v-if="hasPreviewTemplate"\n                      @modal-close="closeModal">\n\n                <sw-text-field\n                        :label="$tc(\'sui.ordermail.to\')"\n                        v-model="mail.toField">\n                </sw-text-field>\n\n                <sw-text-field\n                        :label="$tc(\'sui.ordermail.subject\')"\n                        v-model="mail.subject">\n                </sw-text-field>\n\n                <sw-text-editor\n                        :label="$tc(\'sui.ordermail.content\')"\n                        v-model="mail.content">\n\n                </sw-text-editor>\n\n                <template #modal-footer>\n                    <sw-button size="small" @click="closeModal">\n                        {{ $tc(\'global.default.cancel\') }}\n                    </sw-button>\n\n                    <sw-button @click="onSendMail"\n                               variant="primary"\n                               :disabled="isLoading"\n                               size="small">\n                        {{ $tc(\'sui.ordermail.send\') }}\n                    </sw-button>\n                </template>\n            </sw-modal>\n    </sw-modal>\n{% endblock %}\n'},iGN5:function(e,t,n){var a=n("ZMm1");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("b80b476c",a,!0,{})}},[["HtrP","runtime","vendors-node"]]]);