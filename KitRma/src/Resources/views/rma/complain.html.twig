{% sw_extends '@@KitRma/rma/index.html.twig' %}

{% block page_account_main_content %}
    {% block page_account_rma %}
        <div class="account-rma">

            {% block page_account_rma_main %}
                <div class="account-rma-card card">
                    <div class="card-body">
                        {% block page_account_rma_form %}{% endblock %}
                        {% block page_account_rma_complain_detail %}
                            <div class="row card-header">
                                <div class="col-md-6">Bestellnummer: {{ ordernumber }}</div>
                                <div class="col-md-6">Kunde: {{ customername }}</div>
                            </div>
                            <div class="row card-header">
                                <div class="col-md-6">Ausgew√§hlter Artikel:</div>
                                <div class="col-md-6">
                                    <span id="productTitle">{{ productName|u.truncate(90, '...') }}</span>
                                </div>
                            </div>
                            {% if freetextfields is not defined %}
                                <br/><br/>
                                {{ block('page_account_rma_welcome_intro') }}
                                <p class="legal-notice">{{ "kitRma.complain.notice"|trans|sw_sanitize }}</p>
                            {% endif %}
                        {% endblock %}
                        {% block page_account_rma_legal %}{% endblock %}
                    </div>
                </div>
                <br><br>
            {% endblock %}

            {% block page_account_rma_complain %}
                <form action="{{ path('frontend.rma.ticket') }}"
                      method="post"
                      enctype="multipart/form-data"
                      data-form-csrf-handler="true">
                    {% block page_account_rma_search_csrf %}
                        {{ sw_csrf('frontend.rma.ticket') }}
                    {% endblock %}

                    <input type="hidden"
                           name="productId"
                           id="productId"
                           value="{{ productId }}">

                    <input type="hidden" value="{{ orderId }}" name="orderId"/>
                    <input type="hidden" value="{{ customername }}" name="customername"/>
                    <input type="hidden" value="{{ amount }}" name="amount"/>

                    <div class="account-rma--complain card">
                        <div class="card-body rmaInput">
                            <div class="rma--reason-select">
                                {% if freetextfields is not defined %}
                                    <div>
                                        <b>{{ "kitRma.complain.questionTitle"|trans }}</b>
                                        <br><br>
                                        <div class="form-row rma-row">
                                            {% for item in cases %}
                                                <div class="col-md-4">
                                                    <div class="form-check form-check-inline rma-line">
                                                        <input class="form-check-input"
                                                               type="radio"
                                                               id="gv_id-{{ item.id }}"
                                                               name="case_id"
                                                               value="{{ item.id }}">
                                                        <label class="form-check-label"
                                                               for="gv_id-{{ item.id }}">{{ item.name }}</label>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                        <br/><br/>
                                    </div>
                                {% else %}
                                    <input type="hidden" value="1" name="freetextform"/>
                                    <h2>{{ case.name }}</h2>
                                    <br/>
                                    <div class="complain--freeform">
                                        {% for key,item in freetextfields %}
                                            {% if item.dependOnAmount %}
                                                {% for i in 0..amount-1 %}
                                                    {% include '@KitRma/rma/freetext.html.twig' with {
                                                        field: item,
                                                        key: key,
                                                        i: i
                                                    } %}
                                                {% endfor %}
                                            {% else %}
                                                {% include '@KitRma/rma/freetext.html.twig' with {
                                                    field: item,
                                                    key: key,
                                                    i: 0
                                                } %}
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <br><br>
                                {% endif %}

                                {% if freetextfields is not defined %}
                                    <b>{{ "kitRma.complain.productSelectionTitle"|trans }}</b>
                                    <br><br>
                                    <select name="amount"
                                            id="amountInput"
                                            required
                                            class="custom-select custom-select-sm">
                                        <option value="">
                                            {{ "kitRma.fields.productSelection"|trans({
                                                '%qty%': 0,
                                                '%total%': qty
                                            }) }}
                                        </option>
                                        {% for i in 1..qty %}
                                            <option value="{{ i }}">
                                                {{ "kitRma.fields.productSelection"|trans({
                                                    '%qty%': i,
                                                    '%total%': qty
                                                }) }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                    <br><br>
                                {% endif %}
                            </div>
                            <div class="complain--form-action">
                                <a href="{{ app.request.headers.get('referer') }}"
                                   class="btn btn-secondary">{{ "kitRma.fields.goBack"|trans }}</a>
                                <button type="submit"
                                        name="submit"
                                        class="btn btn-primary float-right">
                                    {{ "kitRma.fields.submitButton"|trans }}
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            {% endblock %}
        </div>
    {% endblock %}
{% endblock %}
